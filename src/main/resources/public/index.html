<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>UNO Game</title>
    <link href="https://cdn.jsdelivr.net/npm/quasar@2/dist/quasar.prod.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/quasar@2/dist/quasar.umd.prod.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client/dist/socket.io.min.js" defer></script>
</head>
<body>
<div id="q-app">
    <q-layout view="lHh Lpr lFf">
        <q-header elevated class="bg-primary text-white">
            <q-toolbar>
                <q-toolbar-title>UNO Multiplayer</q-toolbar-title>
            </q-toolbar>
        </q-header>
        <q-page-container>
            <q-page class="q-pa-md">
                <div v-if="!connected" class="q-gutter-md">
                    <q-input v-model="playerName" label="Player name"></q-input>
                    <q-btn color="primary" label="Connect" @click="connect" :disable="!playerName"></q-btn>
                </div>
                <div v-else class="q-gutter-md">
                    <div v-if="!gameStarted">
                        <div class="text-h6">Waiting room</div>
                        <div v-for="p in waiting" :key="p.name" class="q-mb-xs">
                            <q-chip :label="p.name" :color="p.ready ? 'green' : 'grey'" text-color="white"></q-chip>
                        </div>
                        <q-btn color="green" label="Ready" v-if="!ready" @click="sendReady"></q-btn>
                    </div>
                    <div v-else>
                        <div class="row q-mt-md">
                            <div class="col-12 col-md-3">
                                <q-card>
                                    <q-card-section>
                                        <div class="text-subtitle2">Deck</div>
                                        <div>{{ deckCount }} cards</div>
                                        <div class="q-mt-sm">
                                            <span>Top card:</span>
                                            <q-chip :label="topCardLabel()" :color="topCardColor()"
                                                    text-color="white"></q-chip>
                                        </div>
                                    </q-card-section>
                                </q-card>
                            </div>
                            <div class="col-12 col-md-6">
                                <q-card>
                                    <q-card-section>
                                        <div class="text-subtitle2">Players</div>
                                        <div v-for="p in players" :key="p.name" class="q-mb-xs">
                                            <q-chip :label="p.name + ': ' + p.cards"
                                                    :color="p.name == currentPlayer ? 'orange' : 'secondary'"
                                                    text-color="white"></q-chip>
                                        </div>
                                    </q-card-section>
                                </q-card>
                            </div>
                            <div class="col-12 col-md-3">
                                <q-card class="column" style="height:300px">
                                    <q-card-section class="bg-secondary text-white">Chat</q-card-section>
                                    <q-card-section class="scroll" style="flex:1 1 auto; overflow-y:auto;">
                                        <div v-for="(c,idx) in chats" :key="idx">{{ c }}</div>
                                    </q-card-section>
                                    <q-card-actions>
                                        <q-input dense v-model="chatInput" @keyup.enter="sendChat"
                                                 placeholder="Message"></q-input>
                                        <q-btn flat label="Send" @click="sendChat"></q-btn>
                                    </q-card-actions>
                                </q-card>
                            </div>
                        </div>
                        <div class="q-mt-md">
                            <div class="text-subtitle2">Your hand</div>
                            <div class="row q-col-gutter-sm">
                                <div class="col-auto" v-for="(card, idx) in hand" :key="idx">
                                    <q-chip :label="displayLabel(card)" :color="cardColor(card)" text-color="white"
                                            clickable @click="playCard(idx)"></q-chip>
                                </div>
                            </div>
                            <q-btn color="orange" class="q-mt-sm" label="Skip" v-if="canSkip" @click="skipTurn"></q-btn>
                            <q-btn color="secondary" class="q-mt-sm q-ml-sm"
                                   :label="autoplay ? 'Stop Autoplay' : 'Autoplay'" @click="toggleAutoplay"></q-btn>
                        </div>
                        <q-dialog v-model="colorSelectVisible">
                            <q-card>
                                <q-card-section class="text-subtitle2">Choose color</q-card-section>
                                <q-card-actions class="row justify-around q-gutter-sm">
                                    <q-btn color="red" label="Red" @click="chooseColor('RED')"></q-btn>
                                    <q-btn color="green" label="Green" @click="chooseColor('GREEN')"></q-btn>
                                    <q-btn color="blue" label="Blue" @click="chooseColor('BLUE')"></q-btn>
                                    <q-btn color="yellow" label="Yellow" @click="chooseColor('YELLOW')"></q-btn>
                                </q-card-actions>
                            </q-card>
                        </q-dialog>
                        <div class="q-mt-md" style="max-height:200px; overflow-y:auto;">
                            <div v-for="(m,idx) in messages" :key="idx">
                                <span>{{ m.text }}</span>
                                <q-chip v-for="(c,i) in m.cards" :key="i" :label="displayLabel(c)" :color="cardColor(c)"
                                        text-color="white" class="q-ml-xs"/>
                            </div>
                        </div>
                    </div>
                </div>
            </q-page>
        </q-page-container>
    </q-layout>
</div>
<script src="js/client.js" defer></script>
</body>
</html>
